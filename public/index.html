<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Enviar Mensagens WhatsApp</title>
    <!-- Importação do Material Design Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Estilo customizado -->
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="container">
        <h1><i class="mdi mdi-whatsapp"></i> Enviar Mensagens WhatsApp</h1>
        <form action="/upload" method="post" enctype="multipart/form-data" id="mainForm">

            <div class="mb-3">
                <label for="fileInput" class="form-label"><i class="mdi mdi-upload"></i> Selecione o
                    arquivo:</label>
                <input type="file" class="form-control" id="fileInput" name="fileInput" accept=".csv,.vcf">
            </div>

            <div id="csvColumnSelect" style="display: none;">
                <div class="mb-3">
                    <label class="form-label"><i class="mdi mdi-table-column"></i> Selecione as colunas do
                        CSV:</label>
                    <div class="row g-2">
                        <div class="col-md">
                            <label for="nameColumn" class="form-label">Coluna do Nome:</label>
                            <select class="form-select" id="nameColumn" name="nameColumn">
                            </select>
                        </div>
                        <div class="col-md">
                            <label for="phoneColumn" class="form-label">Coluna do Telefone:</label>
                            <select class="form-select" id="phoneColumn" name="phoneColumn">
                            </select>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" id="loadContactsBtn"><i
                            class="mdi mdi-upload"></i> Carregar Contatos</button>
                </div>
            </div>


            <!-- Formulário para adicionar contato individual -->
            <div class="mb-3">
                <label class="form-label"><i class="mdi mdi-account-plus"></i> Adicionar Contato Individual:</label>
                <div class="row g-2">
                    <div class="col-md">
                        <input type="text" class="form-control" id="newContactName" placeholder="Nome">
                    </div>
                    <div class="col-md">
                        <input type="tel" class="form-control" id="newContactPhone" placeholder="Telefone" type="number">
                    </div>
                    <div class="col-md-auto">
                        <button type="button" class="btn btn-success" id="addContactBtn"><i
                                class="mdi mdi-plus"></i> Adicionar</button>
                    </div>
                </div>
            </div>


            <div class="mb-3">
                <label for="search" class="form-label"><i class="mdi mdi-magnify"></i> Pesquisar Contato:</label>
                <input type="text" class="form-control" id="search" placeholder="Digite para pesquisar">
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="testMode" name="testMode" checked>
                <label class="form-check-label" for="testMode"><i class="mdi mdi-test-tube"></i> Modo de Teste (Não
                    envia mensagens reais)</label>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="mdi mdi-account-multiple"></i> Contatos:</label>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="selectAll">Selecionar
                        Todos</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAll">Desmarcar
                        Todos</button>
                </div>
                <div id="contactList">
                    <!-- A lista de contatos será inserida aqui dinamicamente -->
                </div>
            </div>

            <div class="mb-3">
                <label for="message" class="form-label"><i class="mdi mdi-message-text"></i> Mensagem</label>
                Use:
                <ul>
                    <li><b>[name]</b> para o nome do contato</li>
                    <li><b>[greeting]</b> para "Bom dia", "Boa tarde" ou "Boa noite" (automático)</li>
                </ul>
                <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success" id="sendMessageBtn"><i class="mdi mdi-send"></i> Enviar
                    Mensagens</button>
            </div>
        </form>
    </div>

    <footer>
        © 2024 WhatsApp Sender. Todos os direitos reservados.
    </footer>

    <!-- Janela flutuante (Modal) -->
    <div id="messageModal">
        <div id="messageModalContent">
            <span class="close">×</span>
            <h2>Resultado do Envio</h2>
            <div id="messageText"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Call loadContactsFromServer when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadContactsFromServer(); // Call the function from script.js
        });
    </script>
</body>

</html>